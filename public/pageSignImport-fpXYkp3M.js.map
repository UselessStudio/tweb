{"version":3,"mappings":";mJAaA,IAAIA,EAEJ,MAAMC,EAAiB,SAAW,CAChC,KAAM,CAAC,KAAAC,EAAM,MAAAC,EAAO,OAAAC,CAAA,EAAUJ,EAC1B,IAAAK,EACA,IACQC,EAAA,SAAS,WAAW,YAAYJ,CAAI,EAC9C,MAAMK,EAAgB,MAAMD,EAAU,SAAS,WAAW,UAAU,mCAAoC,CACtG,OAAQE,EAAI,GACZ,SAAUA,EAAI,KACd,eAAgBL,CACf,GAAC,KAAAD,EAAM,aAAc,EAAK,GAE1BK,EAAc,IAAM,uBACrB,MAAMD,EAAU,SAAS,WAAW,QAAQC,EAAc,IAAI,EAC9DF,EAAiBI,EAAA,WAAO,sBAAU,qDAG9BC,EAAK,CACX,OAAQA,EAAiB,KAAM,CAC7B,IAAK,0BAA2B,CAC7BA,EAAiB,QAAU,GAC5BL,EAAiBI,EAAA,WAAO,4BAAgB,sDACxC,KACF,CAEA,QAAS,CACC,cAAM,8BAA+BC,CAAG,EAC1C,MAAAC,EAAeC,EAAW,UAAU,EACvCD,IAAiB,kBAAmBN,EAAAI,EAAA,IAAiB,OAAO,0BAAc,8DACrEE,IAAiB,oBAAmBN,EAAAI,EAAA,IAAiB,OAAO,0BAAc,OAAAI,KAAA,sDAClF,KACF,CACF,CACF,CAEA,SAAS,KAAOT,GAAQ,OAAS,YAAc,mBAAmBA,CAAM,EAAI,GACzEC,GACDA,EAAe,KAAMS,GAAMA,EAAE,QAAQ,OAAO,CAEhD,EAEMC,EAAO,IAAIC,EAAK,kBAAmB,GAAM,IAAM,CACtCC,EAAAF,EAAK,OAAO,kBAAmB,EAAI,EACjCd,GACjB,EAAIiB,GAAuB,CAClBlB,EAAAkB,EACGZ,EAAA,SAAS,gBAAgB,YAAY,YAAa,CAAC,EAAG,sBAAuB,KAAAN,EAAK,CAC9F,CAAC","names":["data","importWebToken","dcId","token","tgAddr","mountPageAfter","rootScope","authorization","App","__vitePreload","err","defaultState","STATE_INIT","n","m","page","Page","putPreloader","_data"],"ignoreList":[],"sources":["../src/pages/pageSignImport.ts"],"sourcesContent":["/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {putPreloader} from '../components/putPreloader';\nimport App from '../config/app';\nimport {STATE_INIT} from '../config/state';\nimport rootScope from '../lib/rootScope';\nimport {AuthState} from '../types';\nimport Page from './page';\n\nlet data: AuthState.signImport['data'];\n\nconst importWebToken = async() => {\n  const {dcId, token, tgAddr} = data;\n  let mountPageAfter: Promise<{default: Page}>;\n  try {\n    rootScope.managers.apiManager.setBaseDcId(dcId);\n    const authorization = await rootScope.managers.apiManager.invokeApi('auth.importWebTokenAuthorization', {\n      api_id: App.id,\n      api_hash: App.hash,\n      web_auth_token: token\n    }, {dcId, ignoreErrors: true});\n\n    if(authorization._ === 'auth.authorization') {\n      await rootScope.managers.apiManager.setUser(authorization.user);\n      mountPageAfter = import('./pageIm');\n      // return;\n    }\n  } catch(err) {\n    switch((err as ApiError).type) {\n      case 'SESSION_PASSWORD_NEEDED': {\n        (err as ApiError).handled = true;\n        mountPageAfter = import('./pagePassword');\n        break;\n      }\n\n      default: {\n        console.error('authorization import error:', err);\n        const defaultState = STATE_INIT.authState._;\n        if(defaultState === 'authStateSignIn') mountPageAfter = import('./pageSignIn');\n        else if(defaultState === 'authStateSignQr') mountPageAfter = import('./pageSignQR');\n        break;\n      }\n    }\n  }\n\n  location.hash = tgAddr?.trim() ? '#?tgaddr=' + encodeURIComponent(tgAddr) : '';\n  if(mountPageAfter) {\n    mountPageAfter.then((m) => m.default.mount());\n  }\n};\n\nconst page = new Page('page-signImport', true, () => {\n  putPreloader(page.pageEl.firstElementChild, true);\n  importWebToken();\n}, (_data: typeof data) => {\n  data = _data;\n  rootScope.managers.appStateManager.pushToState('authState', {_: 'authStateSignImport', data});\n});\n\nexport default page;\n"],"file":"pageSignImport-fpXYkp3M.js"}